@startuml
title Class Diagram TNY360 firmware

class Log {
    + enum Level { Debug, Info, Warning, Error }
    + void Add(Level level, const char* format, ...)
}

class WiFi {
    +void Init();
    +bool Connect(const char* ssid, const char* password);
    +void Disconnect();
    +bool IsConnected();
    +const char* GetIP();
    +const char* GetMAC();
    +void StartAP(const char* ssid, const char* password);
    +void StopAP();
    +bool IsAPStarted();
}

class NVS {
    +void Init();
    +NVSHandle* Open(const char* namespace);
    +void Close(NVSHandle* handle);
}
WiFi -left- NVS : uses >

class NVSHandle {
    + void get(const char* key, void* out_value, size_t* length);
    + void set(const char* key, const void* value, size_t length);
    + void erase(const char* key);
}
NVS "1" -- "0..*" NVSHandle : manages >

class WebServer {
    +Error Init()
    +Error Start()
    +Error Stop()
    +bool IsRunning()
}
WebServer .down. WiFi

class WebSocket {
    +Error Init()
    +Error Attach()
}
WebSocket -- WebServer : uses >

class CaptivePortal {
    +Error Init()
    +Error Attach()
}
CaptivePortal -- WebServer : uses >

class DNSServer {
    +Error Init()
    +Error Start(port)
    +Error Stop()
    +bool IsRunning()
}
DNSServer .down. WiFi

class ProtocolHandlers {
    - Handler handlers[]
}

class Protocol {
    - PendingCall pendingCalls[]
    + Error Handle(Request req, Callback cb)
    + void Resolve(Response res)
}
Protocol -- ProtocolHandlers : uses >

class LED {
    + Error SetColor(Id id, Color color)
    + Error SetColor(Id id, Color color, float duration_s)
    + Error SetColors(Color[] colors)
    + Error SetColors(Color[] colors, float[] durations_s)
    + Error SetColors(Id[] ids, Color[] colors, uint8_t count)
    + Error SetColors(Id[] ids, Color[] colors, float[] durations_s, uint8_t count)
    + Error GetColor(Id id, Color* outColor)
    + Error GetColors(Color[]* outColors)
    + Error GetColors(Id[] ids, Color[]* outColors, uint8_t count)
}

class AnalogScanner {
    + Error Init()
    + Error Calibrate(Id id, float raw_min, float raw_max, float real_min, float real_max)
    + Error GetValue(Id id, float* outValue)
    + Error GetValues(float[]* outValues)
    + Error GetValues(Id[] ids, float[]* outValues)
    + Error GetRawValue(Id id, int* outRawValue)
    + Error GetRawValues(int[]* outRawValues)
    + Error GetRawValues(Id[] ids, int[]* outRawValues)
}

class Motor {
    + Error Init()
    + Error SetAngle(Id id, float angle)
    + Error SetAngle(Id id, float angle, float duration_s)
    + Error SetAngles(float[] angles)
    + Error SetAngles(float[] angles, float[] durations_s)
    + Error SetAngles(Id[] ids, float[] angles)
    + Error SetAngles(Id[] ids, float[] angles, float[] durations_s)
    + Error SetForce(Id id, ForceLevel force)
    + Error SetForces(ForceLevel[] forces)
    + Error SetForces(Id[] ids, ForceLevel[] forces)
    + Error GetForce(Id id, ForceLevel* outForce)
    + Error GetForces(ForceLevel[]* outForces)
    + Error GetForces(Id[] ids, ForceLevel[]* outForces)
    + Error GetTargetAngle(Id id, float* outAngle)
    + Error GetTargetAngles(float[]* outAngles)
    + Error GetTargetAngles(Id[] ids, float[]* outAngles)
    + Error GetCurrentAngle(Id id, float* outAngle)
    + Error GetCurrentAngles(float[]* outAngles)
    + Error GetCurrentAngles(Id[] ids, float[]* outAngles)
}
Motor "1" -- "1" AnalogScanner : uses >

class Pressure {
    + Error Init()
    + Error Calibrate(Callback onDone)
    + Error GetPressure(Id id, float* outPressure)
    + Error GetPressures(float[]* outPressures)
    + Error GetPressures(Id[] ids, float[]* outPressures)
}
Pressure "1" -- "1" AnalogScanner : uses >

class IMU {
    + Error Init()
    + Error Calibrate(Callback onDone)
    + Error GetTemperature(float* outTemperature)
    + Error GetOrientation(Quaternion* outOrientation)
    + Error GetAngularVelocity(Vector3* outAngularVelocity)
    + Error GetLinearAcceleration(Vector3* outLinearAcceleration)
}

class Power {
    + Error Init()
    + Error GetBatteryLevel(float* outLevel)
    + Error IsCharging(bool* outIsCharging)
    + Error GetVoltage(float* outVoltage)
    + Error GetCurrent(float* outCurrent)
}

class Note {
    + enum Tone { C4, D4, E4, F4, G4, A4, B4, C5, REST }
    + Tone tone
    + int octave
    + float frequency_hz
    + Note FromTone(Tone tone, int octave)
    + Note FromFrequency(float frequency_hz)
}

class Partition {
    + Note[] notes
    + float[] durations_s
}
Partition "1" -- "*" Note : contains >

class Sound {
    + Error Init()
    + Error Play(Note[] notes, float[] durations_s)
    + Error Play(Note note, float duration_s)
    + Error Play(Partition partition)
    + Error Stop()
    + bool IsPlaying()
}
Sound "1" -- "0..*" Partition : plays >

class I2C {
    + Error Init()
}

class GPIO {
    + Error Init()
}

@enduml