@startuml
title Class Diagram TNY360 firmware

class Log {
    + enum Level { Debug, Info, Warning, Error }
    + static void Add(Level level, const char* format, ...)
}

class WiFi {
    +static void Init();
    +static bool Connect(const char* ssid, const char* password);
    +static void Disconnect();
    +static bool IsConnected();
    +static const char* GetIP();
    +static const char* GetMAC();
    +static void StartAP(const char* ssid, const char* password);
    +static void StopAP();
    +static bool IsAPStarted();
}

class NVS {
    +static void Init();
    +static NVSHandle* Open(const char* namespace);
    +static void Close(NVSHandle* handle);
}
WiFi -left- NVS : uses >

class NVSHandle {
    + void get(const char* key, void* out_value, size_t* length);
    + void set(const char* key, const void* value, size_t length);
    + void erase(const char* key);
}
NVS "1" -- "0..*" NVSHandle : manages >

class WebServer {
    +static Error Init()
    +static Error Start()
    +static Error Stop()
    +static bool IsRunning()
}
WebServer .down. WiFi

class WebSocket {
    +static Error Init()
    +static Error Attach()
}
WebSocket -- WebServer : uses >

class CaptivePortal {
    +static Error Init()
    +static Error Attach()
}
CaptivePortal -- WebServer : uses >

class DNSServer {
    +static Error Init()
    +static Error Start(port)
    +static Error Stop()
    +static bool IsRunning()
}
DNSServer .down. WiFi

class ProtocolHandlers {
    - static Handler handlers[]
}

class Protocol {
    - static PendingCall pendingCalls[]
    + static Error Handle(Request req, Callback cb)
    + static void Resolve(Response res)
}
Protocol -- ProtocolHandlers : uses >

class LED {
    + static Error SetColor(Id id, Color color)
    + static Error SetColor(Id id, Color color, float duration_s)
    + static Error SetColors(Color[] colors)
    + static Error SetColors(Color[] colors, float[] durations_s)
    + static Error SetColors(Id[] ids, Color[] colors, uint8_t count)
    + static Error SetColors(Id[] ids, Color[] colors, float[] durations_s, uint8_t count)
    + static Error GetColor(Id id, Color* outColor)
    + static Error GetColors(Color[]* outColors)
    + static Error GetColors(Id[] ids, Color[]* outColors, uint8_t count)
}

class AnalogScanner {
    + static Error Init()
    + static Error Calibrate(Id id, float raw_min, float raw_max, float real_min, float real_max)
    + static Error GetValue(Id id, float* outValue)
    + static Error GetValues(float[]* outValues)
    + static Error GetValues(Id[] ids, float[]* outValues)
    + static Error GetRawValue(Id id, int* outRawValue)
    + static Error GetRawValues(int[]* outRawValues)
    + static Error GetRawValues(Id[] ids, int[]* outRawValues)
}

class Motor {
    + static Error Init()
    + static Error SetAngle(Id id, float angle)
    + static Error SetAngle(Id id, float angle, float duration_s)
    + static Error SetAngles(float[] angles)
    + static Error SetAngles(float[] angles, float[] durations_s)
    + static Error SetAngles(Id[] ids, float[] angles)
    + static Error SetAngles(Id[] ids, float[] angles, float[] durations_s)
    + static Error SetForce(Id id, ForceLevel force)
    + static Error SetForces(ForceLevel[] forces)
    + static Error SetForces(Id[] ids, ForceLevel[] forces)
    + static Error GetForce(Id id, ForceLevel* outForce)
    + static Error GetForces(ForceLevel[]* outForces)
    + static Error GetForces(Id[] ids, ForceLevel[]* outForces)
    + static Error GetTargetAngle(Id id, float* outAngle)
    + static Error GetTargetAngles(float[]* outAngles)
    + static Error GetTargetAngles(Id[] ids, float[]* outAngles)
    + static Error GetCurrentAngle(Id id, float* outAngle)
    + static Error GetCurrentAngles(float[]* outAngles)
    + static Error GetCurrentAngles(Id[] ids, float[]* outAngles)
}
Motor "1" -- "1" AnalogScanner : uses >

class Pressure {
    + static Error Init()
    + static Error Calibrate(Callback onDone)
    + static Error GetPressure(Id id, float* outPressure)
    + static Error GetPressures(float[]* outPressures)
    + static Error GetPressures(Id[] ids, float[]* outPressures)
}
Pressure "1" -- "1" AnalogScanner : uses >

class IMU {
    + static Error Init()
    + static Error Calibrate(Callback onDone)
    + static Error GetTemperature(float* outTemperature)
    + static Error GetOrientation(Quaternion* outOrientation)
    + static Error GetAngularVelocity(Vector3* outAngularVelocity)
    + static Error GetLinearAcceleration(Vector3* outLinearAcceleration)
}

class Power {
    + static Error Init()
    + static Error GetBatteryLevel(float* outLevel)
    + static Error IsCharging(bool* outIsCharging)
    + static Error GetVoltage(float* outVoltage)
    + static Error GetCurrent(float* outCurrent)
}

class Note {
    + enum Tone { C4, D4, E4, F4, G4, A4, B4, C5, REST }
    + Tone tone
    + int octave
    + float frequency_hz
    + static Note FromTone(Tone tone, int octave)
    + static Note FromFrequency(float frequency_hz)
}

class Partition {
    + Note[] notes
    + float[] durations_s
}
Partition "1" -- "*" Note : contains >

class Sound {
    + static Error Init()
    + static Error Play(Note[] notes, float[] durations_s)
    + static Error Play(Note note, float duration_s)
    + static Error Play(Partition partition)
    + static Error Stop()
    + static bool IsPlaying()
}
Sound "1" -- "0..*" Partition : plays >

class I2C {
    + static Error Init()
}

class GPIO {
    + static Error Init()
}

@enduml